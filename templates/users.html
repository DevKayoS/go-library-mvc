{{define "users"}}

<div id="users" class="content section active">
    <div class="section-header">
        <h2 class="section-title">üë• Gerenciamento de Usu√°rios</h2>
        <button class="btn btn-primary" onclick="document.getElementById('addUserModal').style.display='block'">
            ‚ûï Adicionar Usu√°rio
        </button>
    </div>


    {{if .IsEdit}}
    <div class="card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">‚úèÔ∏è Editar Usu√°rio</h3>
        </div>
        <form action="/users/{{.User.ID}}/edit" method="POST">
            <div class="form-group">
                <label class="form-label">Nome:</label>
                <input type="text" name="name" class="form-input" value="{{.User.Name}}" required>
            </div>
            <div class="form-group">
                <label class="form-label">Email:</label>
                <input type="email" name="email" class="form-input" value="{{.User.Email}}" required>
            </div>
            <div class="actions">
                <button type="submit" class="btn btn-success">üíæ Salvar Altera√ß√µes</button>
                <a href="/users" class="btn btn-secondary">‚ùå Cancelar</a>
            </div>
        </form>
    </div>
    {{else if .ShowUserLoans}}

    <div class="card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">üìö Empr√©stimos de {{.User.Name}}</h3>
            <a href="/users" class="btn btn-secondary btn-sm">‚Üê Voltar aos Usu√°rios</a>
        </div>
        <div style="padding: 15px;">
            <p><strong>Email:</strong> {{.User.Email}}</p>
            <p><strong>ID:</strong> {{.User.ID}}</p>
        </div>
    </div>

    {{if .Loans}}
    <div class="grid grid-2">
        {{range .Loans}}
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Empr√©stimo #{{.ID}}</h3>
                <span class="card-status {{if eq .Status " active"}}status-active{{else}}status-returned{{end}}">
                    {{if eq .Status "active"}}Ativo{{else}}Devolvido{{end}}
                </span>
            </div>
            <p><strong>Livro:</strong>
                {{if index $.BooksMap .BookID}}
                {{(index $.BooksMap .BookID).Title}} por {{(index $.BooksMap .BookID).Author}}
                {{else}}
                Livro ID: {{.BookID}} (n√£o encontrado)
                {{end}}
            </p>
            <p><strong>Data do Empr√©stimo:</strong> {{.BorrowedAt.Format "02/01/2006 15:04"}}</p>
            {{if .ReturnedAt}}
            <p><strong>Data da Devolu√ß√£o:</strong> {{.ReturnedAt.Format "02/01/2006 15:04"}}</p>
            {{end}}
            <div class="actions">
                {{if eq .Status "active"}}
                <form action="/loans/{{.ID}}/return" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-success btn-sm">üìö Devolver</button>
                </form>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="card" style="text-align: center; padding: 40px;">
        <h3>Nenhum empr√©stimo encontrado</h3>
        <p>Este usu√°rio ainda n√£o possui empr√©stimos registrados.</p>
    </div>
    {{end}}
    {{else}}

    <div class="card" style="margin-bottom: 20px;">
        <form action="/users/search" method="GET" style="display: flex; gap: 15px; align-items: end;">
            <div class="form-group" style="flex: 1;">
                <label class="form-label">Buscar usu√°rios:</label>
                <input type="text" name="q" class="form-input" placeholder="Nome ou email..." value="{{.SearchQuery}}">
            </div>
            <button type="submit" class="btn btn-primary">üîç Buscar</button>
            {{if .SearchQuery}}
            <a href="/users" class="btn btn-secondary">‚ùå Limpar</a>
            {{end}}
        </form>
    </div>


    <div class="grid grid-3">
        {{range .Users}}
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">{{.Name}}</h3>
                <span class="card-status status-active">Ativo</span>
            </div>
            <p><strong>Email:</strong> {{.Email}}</p>
            <p><strong>ID:</strong> {{.ID}}</p>
            <div class="actions">
                <a href="/users/{{.ID}}/edit" class="btn btn-primary btn-sm">‚úèÔ∏è Editar</a>
                <a href="/users/{{.ID}}/loans" class="btn btn-warning btn-sm">üìö Ver Empr√©stimos</a>
                <form action="/users/{{.ID}}/delete" method="POST" style="display: inline;"
                    onsubmit="return confirm('Tem certeza que deseja excluir este usu√°rio?')">
                    <button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è Excluir</button>
                </form>
            </div>
        </div>
        {{else}}
        <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
            <h3>Nenhum usu√°rio encontrado</h3>
            <p>Adicione seu primeiro usu√°rio usando o bot√£o acima.</p>
        </div>
        {{end}}
    </div>
    {{end}}
</div>
{{end}}